<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>è„³ãƒˆãƒ¬ã‚²ãƒ¼ãƒ é›†</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      font-size: 22px; /* å°‘ã—å¤§ãã‚ãƒ™ãƒ¼ã‚¹ */
    }
    body {
      margin: 0;
      background: #f9fafb; /* ã‚ˆã‚Šæ˜ã‚‹ãæŸ”ã‚‰ã‹ã„ã‚°ãƒ¬ãƒ¼ */
      color: #111827;      /* ã»ã¼é»’ */
      display: flex;
      justify-content: center;
    }
    .container {
      max-width: 980px;
      width: 100%;
      padding: 16px;
    }

    main {
      background: #ffffff;
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 8px 20px rgba(15,23,42,0.06);
      border: 1px solid #e5e7eb;
    }

    .screen {
      display: none;
    }
    .screen.active {
      display: block;
    }
    h1.home-title {
      margin: 0;
      font-size: 2.3rem;
      color: #111827;
      text-align: center;
    }
    p.home-subtitle {
      margin: 4px 0 28px; /* ä¸‹ã«ã‚†ã£ãŸã‚Šã‚ã®ä½™ç™½ */
      font-size: 1rem;
      color: #374151;
      text-align: center;
    }
    h2 {
      margin-top: 6px; /* ã‚¿ã‚¤ãƒˆãƒ«ã¨ã®é–“ã«é©åº¦ãªä½™ç™½ */
      font-size: 1.7rem;
      color: #111827;
    }
    h3 {
      margin-top: 1.2rem;
      font-size: 1.2rem;
      color: #111827;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 12px 22px;
      cursor: pointer;
      font-size: 1.05rem;
      background: #60a5fa; /* å°‘ã—ã‚„ã‚ã‚‰ã‹ã„é’ */
      color: #f9fafb;
      transition: transform 0.07s ease, box-shadow 0.07s ease, background 0.15s;
      box-shadow: 0 2px 4px rgba(15,23,42,0.12);
    }
    button:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(15,23,42,0.18);
      background: #3b82f6;
    }
    button:active:not(:disabled) {
      transform: translateY(0);
      box-shadow: 0 1px 2px rgba(15,23,42,0.2);
    }
    button:disabled {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
    }
    .btn-secondary {
      background: #e5e7eb;
      color: #374151;
    }
    .btn-secondary:hover:not(:disabled) {
      background: #d1d5db;
      color: #111827;
    }
    .btn-small {
      font-size: 0.9rem;
      padding: 8px 14px;
    }
    .big-main-btn {
      flex: 1;
      min-width: 140px;
      font-size: 1.3rem;
      padding: 14px 18px;
    }

    .game-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 12px;
      margin-top: 8px;
    }
    .game-card {
      background: #ffffff;
      border-radius: 14px;
      padding: 14px;
      border: 1px solid #e5e7eb;
      box-shadow: 0 3px 8px rgba(15,23,42,0.04);
    }
    .game-card h3 {
      margin-top: 0;
    }
    .tag {
      display: inline-block;
      font-size: 0.9rem;
      padding: 4px 11px;
      border-radius: 999px;
      background: #e0f2fe;  /* ã‚„ã‚ã‚‰ã‹ã„æ°´è‰² */
      color: #1d4ed8;
      margin-bottom: 4px;
    }
    .muted {
      color: #4b5563;
      font-size: 0.95rem;
    }
    /* èª¬æ˜ç”¨ï¼šãã£ãã‚Šè¡¨ç¤º */
    .explain {
      color: #111827;
      font-size: 1.05rem;
      line-height: 1.8;
      font-weight: 500;
      text-shadow: 0 0 2px rgba(255,255,255,0.4);
      margin-bottom: 12px;
    }
    .home-btn {
      background: #93c5fd; /* ãƒ›ãƒ¼ãƒ ã¯æŸ”ã‚‰ã‹ã„é’ */
      color: #111827;
    }
    .home-btn:hover:not(:disabled) {
      background: #60a5fa;
      color: #f9fafb;
    }
    .home-btn-wrapper {
      display: flex;
      justify-content: flex-end;
      margin-top: 10px;
    }
    .ranking-list {
      padding-left: 20px;
      font-size: 0.95rem;
      max-height: 180px;
      overflow-y: auto;
    }
    .ranking-list li {
      margin-bottom: 2px;
    }
    .status-row {
      display: flex;
      justify-content: space-between;
      font-size: 0.95rem;
      margin-bottom: 6px;
      color: #111827;
    }
    input[type="number"],
    input[type="text"] {
      width: 100%;
      padding: 12px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      background: #f3f4f6;
      color: #111827;
      font-size: 1rem;
      box-sizing: border-box;
      margin: 6px 0;
    }
    input:disabled {
      opacity: 0.7;
      background: #e5e7eb;
    }
    .button-row {
      display: flex;
      gap: 8px;
      margin-top: 4px;
      flex-wrap: wrap;
    }
    .emphasis {
      font-weight: 700;
      color: #b45309; /* æ¿ƒã„ã‚ªãƒ¬ãƒ³ã‚¸ã§å¼·èª¿ */
    }

    /* Reaction game */
    #reaction-box {
      text-align: center;
      padding: 20px;
      border-radius: 12px;
      background: #e0f2fe; /* æ·¡ã„æ°´è‰² */
      transition: background 0.2s;
      font-size: 1.05rem;
      border: 1px solid #bfdbfe;
    }
    #reaction-box.go {
      background: #dcfce7; /* ç·‘ã«ãªã£ãŸã¨ã */
      border-color: #a7f3d0;
    }
    #reaction-message {
      margin-bottom: 12px;
      color: #111827;
      font-weight: 500;
    }
    #reaction-result {
      margin-top: 10px;
      font-size: 1.1rem;
      color: #111827;
      font-weight: 600;
    }

    /* Memory game */
    #memory-board {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin: 8px 0 10px;
    }
    .memory-tile {
      height: 100px;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      opacity: 0.9;
      transition: transform 0.08s, opacity 0.08s, box-shadow 0.08s;
    }
    .memory-tile.active {
      transform: scale(1.05);
      opacity: 1;
      box-shadow: 0 0 12px rgba(55,65,81,0.5);
    }
    .memory-tile[data-index="0"] { background: #fee2e2; }
    .memory-tile[data-index="1"] { background: #dcfce7; }
    .memory-tile[data-index="2"] { background: #dbeafe; }
    .memory-tile[data-index="3"] { background: #fef9c3; }
    #memory-level {
      font-weight: 600;
      font-size: 1.1rem;
      color: #111827;
    }

    /* å…±é€šï¼šå¤§ãã‚ãƒœã‚¿ãƒ³ç”¨ */
    .big-option-btn {
      flex: 1;
      min-width: 120px;
      font-size: 1.1rem;
      padding: 12px 10px;
    }

    /* 1ã€œ25ç”¨ãƒœãƒ¼ãƒ‰ */
    #tap25-board {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 8px;
      margin-top: 8px;
    }
    .tap25-cell {
      height: 70px;
      font-size: 1.2rem;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      background: #f9fafb;
      color: #111827;
      cursor: pointer;
      transition: background 0.1s, transform 0.1s, border-color 0.1s;
    }
    .tap25-cell.done {
      background: #dcfce7;
      border-color: #22c55e;
      transform: scale(0.95);
    }

    /* ã‚¹ãƒˆãƒ«ãƒ¼ãƒ—æ–‡å­— */
    #stroop-word {
      font-size: 2.1rem;
      font-weight: 700;
      margin: 10px 0;
      text-align: center;
    }

    /* ãƒ•ãƒ©ãƒƒã‚·ãƒ¥æ•°è¡¨ç¤º */
    #flash-number {
      font-size: 2.6rem;
      font-weight: 700;
      display: inline-block;
      padding: 8px 18px;
      border-radius: 12px;
      background: #4b5563; /* çœŸã£é»’ã‚ˆã‚Šå°‘ã—æŸ”ã‚‰ã‹ã„ã‚°ãƒ¬ãƒ¼ */
      color: #f9fafb;
      border: 2px solid #e5e7eb;
      min-width: 3em;
      text-align: center;
    }
    .flash-highlight {
      animation: flashScale 0.25s ease;
    }
    @keyframes flashScale {
      0% { transform: scale(0.8); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }

    @media (max-width: 640px) {
      main { padding: 12px; }
      :root { font-size: 20px; }
      .tap25-cell { height: 64px; font-size: 1.1rem; }
      .memory-tile { height: 90px; }
      #stroop-word { font-size: 1.8rem; }
      .big-main-btn { font-size: 1.1rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <main>
      <!-- ãƒ›ãƒ¼ãƒ ç”»é¢ -->
      <section id="screen-home" class="screen active">
        <h1 class="home-title">è„³ãƒˆãƒ¬ã‚²ãƒ¼ãƒ é›† ğŸ§ ğŸ®</h1>
        <p class="home-subtitle">åå°„ãƒ»è¨ˆç®—ãƒ»è¨˜æ†¶ãƒ»åˆ¤æ–­ã‚’ã¾ã¨ã‚ã¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ï¼</p>

        <h2>ã‚²ãƒ¼ãƒ ã‚’ãˆã‚‰ã‚“ã§ã‚¹ã‚¿ãƒ¼ãƒˆï¼</h2>

        <div class="game-grid">
          <div class="game-card">
            <span class="tag">åå°„</span>
            <h3>âš¡ åå°„ç¥çµŒã‚²ãƒ¼ãƒ </h3>
            <p class="muted">ã€Œä»Šã ï¼ã€ã®ç¬é–“ã«ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã‚²ãƒ¼ãƒ ã€‚</p>
            <button data-target="screen-reaction">ã“ã®ã‚²ãƒ¼ãƒ ã§éŠã¶</button>
          </div>
          <div class="game-card">
            <span class="tag">è¨ˆç®—</span>
            <h3>â— è¨ˆç®—ãƒãƒ£ãƒ¬ãƒ³ã‚¸</h3>
            <p class="muted">30ç§’ã§ä½•å•ã¨ã‘ã‚‹ã‹ï¼Ÿ</p>
            <button data-target="screen-calc">ã“ã®ã‚²ãƒ¼ãƒ ã§éŠã¶</button>
          </div>
          <div class="game-card">
            <span class="tag">è¨˜æ†¶</span>
            <h3>ğŸ§© è‰²ãƒã‚¹è¨˜æ†¶</h3>
            <p class="muted">å…‰ã‚‹ãƒã‚¹ã®é †ç•ªã‚’è¦šãˆã¦ã‚¿ãƒƒãƒ—ã€‚</p>
            <button data-target="screen-memory">ã“ã®ã‚²ãƒ¼ãƒ ã§éŠã¶</button>
          </div>
          <div class="game-card">
            <span class="tag">æ³¨æ„ãƒ»åˆ¤æ–­</span>
            <h3>ğŸ¨ è‰²ã“ã¨ã°</h3>
            <p class="muted">æ–‡å­—ã®ã€Œã„ã‚ã€ã¨ã€Œæ„å‘³ã€ãŒãšã‚Œã¦ã„ã‚‹ã‚¹ãƒˆãƒ«ãƒ¼ãƒ—èª²é¡Œã€‚</p>
            <button data-target="screen-stroop">ã“ã®ã‚²ãƒ¼ãƒ ã§éŠã¶</button>
          </div>
          <div class="game-card">
            <span class="tag">é›†ä¸­</span>
            <h3>ğŸ”¢ æ•°å­—ã‚¿ãƒƒãƒ— 1ã€œ25</h3>
            <p class="muted">1ã‹ã‚‰25ã¾ã§é †ç•ªã«ã‚¿ãƒƒãƒ—ã€‚ã‚¿ã‚¤ãƒ ã‚¢ã‚¿ãƒƒã‚¯ã€‚</p>
            <button data-target="screen-tap25">ã“ã®ã‚²ãƒ¼ãƒ ã§éŠã¶</button>
          </div>
          <div class="game-card">
            <span class="tag">è¨ˆç®—ãƒ»è¨˜æ†¶</span>
            <h3>â• ãƒ•ãƒ©ãƒƒã‚·ãƒ¥åˆè¨ˆ</h3>
            <p class="muted">æ¬¡ã€…å‡ºã‚‹æ•°å­—ã®åˆè¨ˆã‚’è¦šãˆã‚‹ã€‚é€£ç¶šæ­£è§£æ•°ã‚’ç«¶ã„ã¾ã™ã€‚</p>
            <button data-target="screen-flash">ã“ã®ã‚²ãƒ¼ãƒ ã§éŠã¶</button>
          </div>
        </div>

        <h3 style="margin-top:16px;">ã¿ã‚“ãªã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆï¼‰</h3>
        <div class="game-grid">
          <div class="game-card">
            <h3 style="font-size:1.1rem;">âš¡ åå°„</h3>
            <p id="no-ranking-reaction-home" class="muted">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
            <ol id="ranking-reaction-home" class="ranking-list"></ol>
          </div>
          <div class="game-card">
            <h3 style="font-size:1.1rem;">â— è¨ˆç®—</h3>
            <p id="no-ranking-calc-home" class="muted">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
            <ol id="ranking-calc-home" class="ranking-list"></ol>
          </div>
          <div class="game-card">
            <h3 style="font-size:1.1rem;">ğŸ§© è¨˜æ†¶</h3>
            <p id="no-ranking-memory-home" class="muted">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
            <ol id="ranking-memory-home" class="ranking-list"></ol>
          </div>
          <div class="game-card">
            <h3 style="font-size:1.1rem;">ğŸ¨ è‰²ã“ã¨ã°</h3>
            <p id="no-ranking-stroop-home" class="muted">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
            <ol id="ranking-stroop-home" class="ranking-list"></ol>
          </div>
          <div class="game-card">
            <h3 style="font-size:1.1rem;">ğŸ”¢ 1ã€œ25</h3>
            <p id="no-ranking-tap25-home" class="muted">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
            <ol id="ranking-tap25-home" class="ranking-list"></ol>
          </div>
          <div class="game-card">
            <h3 style="font-size:1.1rem;">â• ãƒ•ãƒ©ãƒƒã‚·ãƒ¥</h3>
            <p id="no-ranking-flash-home" class="muted">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
            <ol id="ranking-flash-home" class="ranking-list"></ol>
          </div>
        </div>
      </section>

      <!-- åå°„ç¥çµŒã‚²ãƒ¼ãƒ  -->
      <section id="screen-reaction" class="screen">
        <h2>âš¡ åå°„ç¥çµŒã‚²ãƒ¼ãƒ </h2>
        <p class="explain">
          ã€Œã‚¹ã‚¿ãƒ¼ãƒˆã€ã§å°‘ã—å¾…ã¤ã¨ã€ç”»é¢ãŒ<span class="emphasis">ç·‘è‰²</span>ã«ãªã‚Šã¾ã™ã€‚<br />
          ç·‘ã«ãªã£ãŸã‚‰ã€ã§ãã‚‹ã ã‘æ—©ã<strong>ã€Œä»Šã ï¼ã€ãƒœã‚¿ãƒ³</strong>ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚<br />
          ç´å¾—ã„ãè¨˜éŒ²ãŒå‡ºãŸã‚‰<strong>ã€Œçµ‚äº†ãƒ»ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç™»éŒ²ã€</strong>ã§ç™»éŒ²ã§ãã¾ã™ã€‚<br />
          ã‚„ã‚Šç›´ã—ãŸã„ã¨ãã¯<strong>ã€Œãƒªã‚»ãƒƒãƒˆã€</strong>ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚
        </p>

        <div class="game-card" id="reaction-box">
          <p id="reaction-message">æº–å‚™OKï¼Ÿã€Œã‚¹ã‚¿ãƒ¼ãƒˆã€ã‚’æŠ¼ã—ã¦ã­ã€‚</p>
          <div class="button-row" style="justify-content:center; margin-top:8px;">
            <button id="reaction-start-btn" class="big-main-btn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
            <button id="reaction-click-btn" class="big-main-btn" disabled>ä»Šã ï¼</button>
          </div>
          <div class="button-row" style="justify-content:center; margin-top:14px;">
            <button id="reaction-end-btn" class="btn-secondary btn-small">çµ‚äº†ãƒ»ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç™»éŒ²</button>
            <button id="reaction-reset-btn" class="btn-secondary btn-small">ãƒªã‚»ãƒƒãƒˆ</button>
          </div>
          <p id="reaction-result"></p>
        </div>

        <div class="home-btn-wrapper">
          <button class="home-btn" data-target="screen-home">ğŸ  ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹</button>
        </div>

        <h3>âš¡ åå°„ç¥çµŒãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆå°ã•ã„ã»ã©ã‚¹ã‚´ã‚¤ï¼‰</h3>
        <p id="no-ranking-reaction" class="muted">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
        <ol id="ranking-reaction" class="ranking-list"></ol>
      </section>

      <!-- è¨ˆç®—ãƒãƒ£ãƒ¬ãƒ³ã‚¸ -->
      <section id="screen-calc" class="screen">
        <h2>â— è¨ˆç®—ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼ˆ30ç§’ï¼‰</h2>
        <p class="explain">
          ã€Œã‚¹ã‚¿ãƒ¼ãƒˆã€ã§30ç§’ã®ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ãŒå§‹ã¾ã‚Šã¾ã™ã€‚<br />
          è¶³ã—ç®—ãƒ»å¼•ãç®—ã‚’ã§ãã‚‹ã ã‘ãŸãã•ã‚“è§£ãã¾ã—ã‚‡ã†ã€‚<br />
          æº€è¶³ã—ãŸã¨ã“ã‚ã§<strong>ã€Œçµ‚äº†ãƒ»ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç™»éŒ²ã€</strong>ã‚’æŠ¼ã™ã¨ã€ãã®å›ã®æ­£è§£æ•°ã§ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç™»éŒ²ã—ã¾ã™ã€‚<br />
          ã‚„ã‚Šç›´ã—ãŸã„ã¨ãã¯<strong>ã€Œãƒªã‚»ãƒƒãƒˆã€</strong>ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚
        </p>

        <div class="game-card">
          <div class="status-row">
            <span>æ®‹ã‚Šæ™‚é–“ï¼š<span id="calc-time">30</span> ç§’</span>
            <span>æ­£è§£æ•°ï¼š<span id="calc-score">0</span></span>
          </div>

          <div id="calc-question-area" style="font-size:1.8rem; margin: 8px 0; font-weight:600;">
            <span id="calc-question">ã€Œã‚¹ã‚¿ãƒ¼ãƒˆã€ã‚’æŠ¼ã—ã¦ã‚²ãƒ¼ãƒ é–‹å§‹ï¼</span>
          </div>

          <input id="calc-answer" type="number" placeholder="ã“ã“ã«ç­”ãˆã‚’å…¥åŠ›ï¼ˆEnterã§ã‚‚OKï¼‰" disabled />
          <div class="button-row">
            <button id="calc-start-btn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
            <button id="calc-submit-btn" disabled>å›ç­”</button>
            <button id="calc-end-btn" class="btn-secondary btn-small">çµ‚äº†ãƒ»ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç™»éŒ²</button>
            <button id="calc-reset-btn" class="btn-secondary btn-small">ãƒªã‚»ãƒƒãƒˆ</button>
          </div>
          <p id="calc-message" class="muted"></p>
        </div>

        <div class="home-btn-wrapper">
          <button class="home-btn" data-target="screen-home">ğŸ  ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹</button>
        </div>

        <h3>â— è¨ˆç®—ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆå¤šã„ã»ã©ã‚¹ã‚´ã‚¤ï¼‰</h3>
        <p id="no-ranking-calc" class="muted">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
        <ol id="ranking-calc" class="ranking-list"></ol>
      </section>

      <!-- è¨˜æ†¶åŠ›ã‚²ãƒ¼ãƒ ï¼ˆè‰²ãƒã‚¹ï¼‰ -->
      <section id="screen-memory" class="screen">
        <h2>ğŸ§© è¨˜æ†¶åŠ›ã‚²ãƒ¼ãƒ ï¼ˆè‰²ãƒã‚¹ï¼‰</h2>
        <p class="explain">
          ã€Œã‚¹ã‚¿ãƒ¼ãƒˆã€ã‚’æŠ¼ã™ã¨ã€è‰²ã®ãƒã‚¹ãŒé †ç•ªã«å…‰ã‚Šã¾ã™ã€‚<br />
          å…‰ã£ãŸé †ç•ªã©ãŠã‚Šã«ãƒã‚¹ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚<br />
          å¤±æ•—ã—ãŸã¨ãã®<strong>åˆ°é”ãƒ¬ãƒ™ãƒ«</strong>ãŒã‚¹ã‚³ã‚¢ã«ãªã‚Šã¾ã™ã€‚<br />
          æº€è¶³ã—ãŸã¨ã“ã‚ã§<strong>ã€Œçµ‚äº†ãƒ»ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç™»éŒ²ã€</strong>ã‚’æŠ¼ã™ã¨ã€ãã®åˆ°é”ãƒ¬ãƒ™ãƒ«ã§ç™»éŒ²ã§ãã¾ã™ã€‚<br />
          ã‚„ã‚Šç›´ã—ãŸã„ã¨ãã¯<strong>ã€Œãƒªã‚»ãƒƒãƒˆã€</strong>ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚
        </p>

        <div class="game-card">
          <div id="memory-board">
            <button class="memory-tile" data-index="0"></button>
            <button class="memory-tile" data-index="1"></button>
            <button class="memory-tile" data-index="2"></button>
            <button class="memory-tile" data-index="3"></button>
          </div>
          <p>åˆ°é”ãƒ¬ãƒ™ãƒ«ï¼š<span id="memory-level">0</span></p>
          <div class="button-row">
            <button id="memory-start-btn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
            <button id="memory-end-btn" class="btn-secondary btn-small">çµ‚äº†ãƒ»ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç™»éŒ²</button>
            <button id="memory-reset-btn" class="btn-secondary btn-small">ãƒªã‚»ãƒƒãƒˆ</button>
          </div>
          <p id="memory-message" class="muted">ã¾ãšã¯ã€Œã‚¹ã‚¿ãƒ¼ãƒˆã€ã‚’æŠ¼ã—ã¦ã­ã€‚</p>
        </div>

        <div class="home-btn-wrapper">
          <button class="home-btn" data-target="screen-home">ğŸ  ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹</button>
        </div>

        <h3>ğŸ§© è¨˜æ†¶åŠ›ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆãƒ¬ãƒ™ãƒ«ãŒé«˜ã„ã»ã©ã‚¹ã‚´ã‚¤ï¼‰</h3>
        <p id="no-ranking-memory" class="muted">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
        <ol id="ranking-memory" class="ranking-list"></ol>
      </section>

      <!-- ã‚¹ãƒˆãƒ«ãƒ¼ãƒ—è‰²ã“ã¨ã°ï¼ˆ30ç§’ã‚¿ã‚¤ãƒ ã‚¢ã‚¿ãƒƒã‚¯ï¼‰ -->
      <section id="screen-stroop" class="screen">
        <h2>ğŸ¨ è‰²ã“ã¨ã°ã‚²ãƒ¼ãƒ ï¼ˆ30ç§’ï¼‰</h2>
        <p class="explain">
          è¡¨ç¤ºã•ã‚Œã‚‹ã€Œã“ã¨ã°ã€ã®<strong>ã‚¤ãƒ³ã‚¯ã®è‰²</strong>ã‚’ç­”ãˆã‚‹ã‚²ãƒ¼ãƒ ã§ã™ã€‚<br />
          ä¾‹ï¼šã€Œèµ¤ã€ã¨ã„ã†æ–‡å­—ãŒé’è‰²ã§è¡¨ç¤º â†’ æ­£è§£ã¯ã€Œé’ã€ã€‚<br />
          ã€Œã‚¹ã‚¿ãƒ¼ãƒˆã€ã§30ç§’ã®ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ãŒå§‹ã¾ã‚Šã€<strong>ãã®é–“ã«ä½•å•æ­£è§£ã§ãã‚‹ã‹</strong>ã‚’ç«¶ã„ã¾ã™ã€‚<br />
          æº€è¶³ã—ãŸã¨ã“ã‚ã§<strong>ã€Œçµ‚äº†ãƒ»ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç™»éŒ²ã€</strong>ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚<br />
          ã‚„ã‚Šç›´ã—ãŸã„ã¨ãã¯<strong>ã€Œãƒªã‚»ãƒƒãƒˆã€</strong>ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚
        </p>

        <div class="game-card">
          <div class="status-row">
            <span>æ®‹ã‚Šæ™‚é–“ï¼š<span id="stroop-time">30</span> ç§’</span>
            <span>æ­£è§£æ•°ï¼š<span id="stroop-correct">0</span></span>
          </div>
          <div id="stroop-word">ã‚¹ã‚¿ãƒ¼ãƒˆã‚’æŠ¼ã—ã¦ã­</div>
          <div class="button-row">
            <button class="big-option-btn" data-stroop-answer="èµ¤">èµ¤</button>
            <button class="big-option-btn" data-stroop-answer="é’">é’</button>
            <button class="big-option-btn" data-stroop-answer="ç·‘">ç·‘</button>
            <button class="big-option-btn" data-stroop-answer="é»„">é»„</button>
          </div>
          <div class="button-row" style="margin-top:10px;">
            <button id="stroop-start-btn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
            <button id="stroop-end-btn" class="btn-secondary btn-small">çµ‚äº†ãƒ»ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç™»éŒ²</button>
            <button id="stroop-reset-btn" class="btn-secondary btn-small">ãƒªã‚»ãƒƒãƒˆ</button>
          </div>
          <p id="stroop-message" class="muted"></p>
        </div>

        <div class="home-btn-wrapper">
          <button class="home-btn" data-target="screen-home">ğŸ  ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹</button>
        </div>

        <h3>ğŸ¨ è‰²ã“ã¨ã°ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆå¤šã„ã»ã©ã‚¹ã‚´ã‚¤ï¼‰</h3>
        <p id="no-ranking-stroop" class="muted">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
        <ol id="ranking-stroop" class="ranking-list"></ol>
      </section>

      <!-- æ•°å­—ã‚¿ãƒƒãƒ— 1ã€œ25 -->
      <section id="screen-tap25" class="screen">
        <h2>ğŸ”¢ æ•°å­—ã‚¿ãƒƒãƒ— 1ã€œ25</h2>
        <p class="explain">
          ã€Œã‚¹ã‚¿ãƒ¼ãƒˆã€ã§1ã€œ25ã®æ•°å­—ãŒãƒãƒ©ãƒãƒ©ã«ä¸¦ã³ã¾ã™ã€‚<br />
          1â†’2â†’3â€¦ã¨é †ç•ªã«ã‚¿ãƒƒãƒ—ã—ã¦ã„ãã€25ã¾ã§æŠ¼ã—åˆ‡ã‚‹ã‚¿ã‚¤ãƒ ã‚’ç«¶ã„ã¾ã™ã€‚<br />
          25ã¾ã§ã‚¯ãƒªã‚¢ã—ãŸã‚ã¨ã«<strong>ã€Œçµ‚äº†ãƒ»ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç™»éŒ²ã€</strong>ã‚’æŠ¼ã™ã¨ã€ãã®ã‚¿ã‚¤ãƒ ã§ç™»éŒ²ã—ã¾ã™ã€‚<br />
          é€”ä¸­ã§ã‚„ã‚ã‚‹ã¨ãã¯<strong>ã€Œãƒªã‚»ãƒƒãƒˆã€</strong>ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚
        </p>

        <div class="game-card">
          <div class="status-row">
            <span>æ¬¡ã®æ•°å­—ï¼š<span id="tap25-next">1</span></span>
            <span>çµŒéæ™‚é–“ï¼š<span id="tap25-time">0.0</span> ç§’</span>
          </div>
          <div id="tap25-board"></div>
          <div class="button-row" style="margin-top:10px;">
            <button id="tap25-start-btn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
            <button id="tap25-end-btn" class="btn-secondary btn-small">çµ‚äº†ãƒ»ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç™»éŒ²</button>
            <button id="tap25-reset-btn" class="btn-secondary btn-small">ãƒªã‚»ãƒƒãƒˆ</button>
          </div>
          <p id="tap25-message" class="muted"></p>
        </div>

        <div class="home-btn-wrapper">
          <button class="home-btn" data-target="screen-home">ğŸ  ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹</button>
        </div>

        <h3>ğŸ”¢ 1ã€œ25 ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆå°ã•ã„ã»ã©ã‚¹ã‚´ã‚¤ï¼‰</h3>
        <p id="no-ranking-tap25" class="muted">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
        <ol id="ranking-tap25" class="ranking-list"></ol>
      </section>

      <!-- ãƒ•ãƒ©ãƒƒã‚·ãƒ¥åˆè¨ˆï¼ˆé€£ç¶šæ­£è§£æ•°ã§ç«¶ã†ï¼‰ -->
      <section id="screen-flash" class="screen">
        <h2>â• ãƒ•ãƒ©ãƒƒã‚·ãƒ¥åˆè¨ˆã‚²ãƒ¼ãƒ </h2>
        <p class="explain">
          1ã‚±ã‚¿ã®æ•°å­—ãŒæ¬¡ã€…ã«è¡¨ç¤ºã•ã‚Œã¾ã™ï¼ˆåŒã˜æ•°å­—ãŒ<span class="emphasis">ç¶šã‘ã¦å‡ºãªã„</span>ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ï¼‰ã€‚<br />
          ã™ã¹ã¦ã®æ•°å­—ã®<strong>åˆè¨ˆ</strong>ã‚’è¦šãˆã¦ãŠãã€æœ€å¾Œã«ç­”ãˆã¾ã—ã‚‡ã†ã€‚<br />
          1å•ã”ã¨ã«ã€Œæ­£è§£ / ä¸æ­£è§£ã€ã‚’è¡¨ç¤ºã—ã€<strong>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒè‡ªåˆ†ã§ã€Œæ¬¡ã®å•é¡Œã€ãƒœã‚¿ãƒ³ã§é€²ã¿ã¾ã™</strong>ã€‚<br />
          <strong>é€£ç¶šã§æ­£è§£ã—ãŸå›æ•°ï¼ˆæœ€é«˜é€£ç¶šæ­£è§£æ•°ï¼‰</strong>ãŒã‚¹ã‚³ã‚¢ã«ãªã‚Šã¾ã™ã€‚<br />
          æº€è¶³ã—ãŸã¨ã“ã‚ã§<strong>ã€Œçµ‚äº†ãƒ»ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç™»éŒ²ã€</strong>ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚ã‚„ã‚Šç›´ã—ã¯<strong>ã€Œãƒªã‚»ãƒƒãƒˆã€</strong>ã§ã€‚
        </p>

        <div class="game-card">
          <div class="status-row">
            <span>ç¾åœ¨ã®é€£ç¶šæ­£è§£ï¼š<span id="flash-streak">0</span> å›</span>
            <span>æœ€é«˜é€£ç¶šæ­£è§£ï¼š<span id="flash-best">0</span> å›</span>
          </div>
          <div style="text-align:center; margin:10px 0;">
            <span id="flash-number">ã‚¹ã‚¿ãƒ¼ãƒˆã‚’æŠ¼ã—ã¦ã­</span>
          </div>
          <input id="flash-answer" type="number" placeholder="åˆè¨ˆã‚’å…¥åŠ›" disabled />
          <div class="button-row">
            <button id="flash-next-btn">ã‚¹ã‚¿ãƒ¼ãƒˆ / æ¬¡ã®å•é¡Œ</button>
            <button id="flash-submit-btn" disabled>å›ç­”</button>
            <button id="flash-end-btn" class="btn-secondary btn-small">çµ‚äº†ãƒ»ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç™»éŒ²</button>
            <button id="flash-reset-btn" class="btn-secondary btn-small">ãƒªã‚»ãƒƒãƒˆ</button>
          </div>
          <p id="flash-message" class="muted"></p>
        </div>

        <div class="home-btn-wrapper">
          <button class="home-btn" data-target="screen-home">ğŸ  ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹</button>
        </div>

        <h3>â• ãƒ•ãƒ©ãƒƒã‚·ãƒ¥åˆè¨ˆ ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆé€£ç¶šæ­£è§£ãŒå¤šã„ã»ã©ã‚¹ã‚´ã‚¤ï¼‰</h3>
        <p id="no-ranking-flash" class="muted">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
        <ol id="ranking-flash" class="ranking-list"></ol>
      </section>
    </main>
  </div>

  <script>
    // ===== ç”»é¢åˆ‡ã‚Šæ›¿ãˆ =====
    const screens = document.querySelectorAll(".screen");
    function showScreen(id) {
      screens.forEach((s) => s.classList.remove("active"));
      const target = document.getElementById(id);
      if (target) target.classList.add("active");
    }
    document.querySelectorAll("[data-target]").forEach((btn) => {
      btn.addEventListener("click", () => {
        const id = btn.getAttribute("data-target");
        // ã‚¿ã‚¤ãƒãƒ¼ç³»ã‚²ãƒ¼ãƒ ã‚’é™ã‹ã«æ­¢ã‚ã‚‹
        if (window.calcForceStop) window.calcForceStop();
        if (window.flashForceStop) window.flashForceStop();
        if (window.tap25ForceStop) window.tap25ForceStop();
        if (window.stroopForceStop) window.stroopForceStop();
        showScreen(id);
      });
    });

    // ===== ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç®¡ç† =====
    const RANKING_KEY = "brainTrainerRankings_v4";
    let rankings = {};

    function loadRankings() {
      try {
        const saved = localStorage.getItem(RANKING_KEY);
        if (saved) {
          rankings = JSON.parse(saved);
        }
      } catch (e) {
        console.warn("ãƒ©ãƒ³ã‚­ãƒ³ã‚°èª­ã¿è¾¼ã¿å¤±æ•—:", e);
        rankings = {};
      }
    }

    function saveRankings() {
      try {
        localStorage.setItem(RANKING_KEY, JSON.stringify(rankings));
      } catch (e) {
        console.warn("ãƒ©ãƒ³ã‚­ãƒ³ã‚°ä¿å­˜å¤±æ•—:", e);
      }
    }

    function addScore(gameId, name, score, higherIsBetter) {
      if (!rankings[gameId]) rankings[gameId] = [];
      rankings[gameId].push({ name, score });

      rankings[gameId].sort((a, b) => {
        return higherIsBetter ? b.score - a.score : a.score - b.score;
      });

      rankings[gameId] = rankings[gameId].slice(0, 10);
      saveRankings();
      renderRanking(gameId);
    }

    function renderRankingList(gameId, suffix) {
      const list = document.getElementById(`ranking-${gameId}${suffix}`);
      const noMsg = document.getElementById(`no-ranking-${gameId}${suffix}`);
      if (!list) return;
      list.innerHTML = "";

      const data = rankings[gameId] || [];
      if (!data.length) {
        if (noMsg) noMsg.style.display = "block";
        return;
      }
      if (noMsg) noMsg.style.display = "none";

      data.forEach((entry, index) => {
        const li = document.createElement("li");
        let medal = "";
        if (index === 0) medal = "ğŸ‘‘ ";
        else if (index === 1) medal = "ğŸ¥ˆ ";
        else if (index === 2) medal = "ğŸ¥‰ ";

        let unit = "";
        if (gameId === "reaction") unit = " ms";
        if (gameId === "calc") unit = " å•";
        if (gameId === "memory") unit = " ãƒ¬ãƒ™ãƒ«";
        if (gameId === "stroop") unit = " å•";
        if (gameId === "tap25") unit = " ç§’";
        if (gameId === "flash") unit = " å›";

        li.textContent = `${medal}${index + 1}ä½: ${entry.name} - ${entry.score}${unit}`;
        list.appendChild(li);
      });
    }

    function renderRanking(gameId) {
      renderRankingList(gameId, "");
      renderRankingList(gameId, "-home");
    }

    function askNameAndSave(gameId, score, higherIsBetter) {
      if (score == null || Number.isNaN(score)) return;

      let comment = "";
      if (gameId === "reaction") {
        if (score < 150) comment = "ç¥é€Ÿï¼äººé–“é›¢ã‚Œã—ãŸåå°„ç¥çµŒï¼";
        else if (score < 250) comment = "ã‹ãªã‚Šé€Ÿã„ï¼ãƒŠã‚¤ã‚¹é›†ä¸­ï¼";
        else comment = "ã¾ãšã¯ã“ã“ã‹ã‚‰ã€‚ã‚‚ã†ä¸€å›ã‚„ã£ã¦ã¿ã‚ˆã†ï¼";
      } else if (gameId === "calc") {
        if (score >= 20) comment = "å¤©æ‰ç´šã®è¨ˆç®—åŠ›ï¼";
        else if (score >= 10) comment = "ã„ã„ãƒšãƒ¼ã‚¹ï¼ãã®èª¿å­ï¼";
        else comment = "ã‚¦ã‚©ãƒ¼ãƒŸãƒ³ã‚°ã‚¢ãƒƒãƒ—ã¯ã“ã“ã‹ã‚‰ï¼";
      } else if (gameId === "memory") {
        if (score >= 10) comment = "ã™ã”ã„è¨˜æ†¶åŠ›ï¼";
        else if (score >= 5) comment = "é›†ä¸­ã§ãã¦ã‚‹ï¼";
        else comment = "ç¶šã‘ã‚Œã°ã‚‚ã£ã¨ä¼¸ã³ã‚‹ã‚ˆï¼";
      } else if (gameId === "tap25") {
        if (score <= 25) comment = "è¶…é«˜é€Ÿã‚¯ãƒªã‚¢ï¼";
        else if (score <= 40) comment = "ãªã‹ãªã‹ã®é€Ÿã•ï¼";
        else comment = "æ¬¡ã¯ã‚‚ã†å°‘ã—æ€¥ã„ã§ã¿ã‚ˆã†ï¼";
      } else if (["stroop", "flash"].includes(gameId)) {
        if (score >= 20) comment = "é›†ä¸­åŠ›ãƒãƒƒãƒãƒªï¼";
        else if (score >= 10) comment = "ã„ã„èª¿å­ï¼";
        else comment = "å°‘ã—ãšã¤æ…£ã‚Œã¦ã„ã“ã†ï¼";
      }

      if (comment) alert(comment);

      const name = prompt("ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«ç™»éŒ²ã™ã‚‹åå‰ã‚’å…¥åŠ›ã—ã¦ã­ï¼ˆã‚­ãƒ£ãƒ³ã‚»ãƒ«ã§ã‚¹ã‚­ãƒƒãƒ—ï¼‰");
      if (name && name.trim()) {
        addScore(gameId, name.trim(), score, higherIsBetter);
        alert("ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«ç™»éŒ²ã—ãŸã‚ˆï¼");
      }
    }

    // ===== åå°„ç¥çµŒã‚²ãƒ¼ãƒ  =====
    (function setupReactionGame() {
      const box = document.getElementById("reaction-box");
      const message = document.getElementById("reaction-message");
      const result = document.getElementById("reaction-result");
      const startBtn = document.getElementById("reaction-start-btn");
      const clickBtn = document.getElementById("reaction-click-btn");
      const endBtn = document.getElementById("reaction-end-btn");
      const resetBtn = document.getElementById("reaction-reset-btn");

      let state = "idle"; // idle | waiting | go
      let timeoutId = null;
      let startTime = 0;
      let lastScore = null;

      function resetForNext() {
        state = "idle";
        startBtn.disabled = false;
        clickBtn.disabled = true;
        box.classList.remove("go");
        if (timeoutId) clearTimeout(timeoutId);
        timeoutId = null;
      }

      function resetUI() {
        resetForNext();
        lastScore = null;
        message.textContent = "æº–å‚™OKï¼Ÿã€Œã‚¹ã‚¿ãƒ¼ãƒˆã€ã‚’æŠ¼ã—ã¦ã­ã€‚";
        result.textContent = "";
      }

      startBtn.addEventListener("click", () => {
        resetForNext();
        state = "waiting";
        startBtn.disabled = true;
        clickBtn.disabled = false;
        result.textContent = "";
        message.textContent = "è‰²ãŒå¤‰ã‚ã‚‹ã¾ã§ã˜ã£ã¨å¾…ã£ã¦â€¦ ãƒ•ãƒ©ã‚¤ãƒ³ã‚°ç¦æ­¢ï¼";

        const delay = 1500 + Math.random() * 2000;
        timeoutId = setTimeout(() => {
          state = "go";
          box.classList.add("go");
          message.textContent = "ä»Šã ï¼ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ï¼";
          startTime = performance.now();
        }, delay);
      });

      clickBtn.addEventListener("click", () => {
        if (state === "waiting") {
          message.textContent = "ãƒ•ãƒ©ã‚¤ãƒ³ã‚°ï¼ã‚‚ã†ä¸€åº¦ã‚„ã£ã¦ã¿ã‚ˆã†ã€‚";
          result.textContent = "";
          resetForNext();
          return;
        }
        if (state === "go") {
          const diff = Math.round(performance.now() - startTime);
          lastScore = diff;
          result.textContent = `ä»Šå›ã®åå¿œæ™‚é–“ï¼š${diff} ms`;
          message.textContent = "ç´å¾—ã„ãè¨˜éŒ²ãŒå‡ºãŸã‚‰ã€Œçµ‚äº†ãƒ»ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç™»éŒ²ã€ã§ç™»éŒ²ã—ã¦ã­ã€‚";
          resetForNext();
        }
      });

      endBtn.addEventListener("click", () => {
        if (lastScore == null) {
          alert("ã¾ã ç™»éŒ²ã§ãã‚‹è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã¾ãšã¯ãƒ—ãƒ¬ã‚¤ã—ã¦ã¿ã‚ˆã†ï¼");
          resetUI();
          return;
        }
        askNameAndSave("reaction", lastScore, false);
        resetUI();
      });

      resetBtn.addEventListener("click", () => {
        resetUI();
      });
    })();

    // ===== è¨ˆç®—ãƒãƒ£ãƒ¬ãƒ³ã‚¸ =====
    (function setupCalcGame() {
      const timeEl = document.getElementById("calc-time");
      const scoreEl = document.getElementById("calc-score");
      const questionEl = document.getElementById("calc-question");
      const answerInput = document.getElementById("calc-answer");
      const startBtn = document.getElementById("calc-start-btn");
      const submitBtn = document.getElementById("calc-submit-btn");
      const endBtn = document.getElementById("calc-end-btn");
      const resetBtn = document.getElementById("calc-reset-btn");
      const msg = document.getElementById("calc-message");

      let remaining = 30;
      let score = 0;
      let currentAnswer = null;
      let timerId = null;
      let playing = false;
      let lastScore = null;

      function updateDisplay() {
        timeEl.textContent = remaining;
        scoreEl.textContent = score;
      }

      function resetAll() {
        playing = false;
        if (timerId) clearInterval(timerId);
        timerId = null;
        remaining = 30;
        score = 0;
        lastScore = null;
        updateDisplay();
        questionEl.textContent = "ã€Œã‚¹ã‚¿ãƒ¼ãƒˆã€ã‚’æŠ¼ã—ã¦ã‚²ãƒ¼ãƒ é–‹å§‹ï¼";
        answerInput.value = "";
        answerInput.disabled = true;
        submitBtn.disabled = true;
        startBtn.disabled = false;
        msg.textContent = "";
      }

      function makeQuestion() {
        const a = Math.floor(Math.random() * 20) + 1;
        const b = Math.floor(Math.random() * 20) + 1;
        const usePlus = Math.random() < 0.5;
        let text, ans;
        if (usePlus) {
          text = `${a} + ${b} = ?`;
          ans = a + b;
        } else {
          const bigger = Math.max(a, b);
          const smaller = Math.min(a, b);
          text = `${bigger} - ${smaller} = ?`;
          ans = bigger - smaller;
        }
        questionEl.textContent = text;
        currentAnswer = ans;
      }

      function finishRun(reason) {
        playing = false;
        if (timerId) clearInterval(timerId);
        timerId = null;
        answerInput.disabled = true;
        submitBtn.disabled = true;
        startBtn.disabled = false;
        lastScore = score;
        if (reason === "time") {
          msg.textContent = `æ™‚é–“åˆ‡ã‚Œï¼æ­£è§£æ•°ã¯ ${score} å•ã§ã—ãŸã€‚`;
        } else if (reason === "manual") {
          msg.textContent = `æ‰‹å‹•ã§çµ‚äº†ã—ã¾ã—ãŸã€‚æ­£è§£æ•°ã¯ ${score} å•ã§ã—ãŸã€‚`;
        }
      }

      function handleAnswer() {
        if (!playing) return;
        const val = parseInt(answerInput.value, 10);
        if (Number.isNaN(val)) {
          msg.textContent = "æ•°å­—ã§ç­”ãˆã‚’å…¥åŠ›ã—ã¦ã­ã€‚";
          return;
        }
        if (val === currentAnswer) {
          score++;
          msg.textContent = "æ­£è§£ï¼ã„ã„ãƒšãƒ¼ã‚¹ï¼";
        } else {
          msg.textContent = `ãŠã—ã„â€¦ æ­£è§£ã¯ ${currentAnswer} ã§ã—ãŸã€‚`;
        }
        answerInput.value = "";
        updateDisplay();
        makeQuestion();
      }

      startBtn.addEventListener("click", () => {
        playing = true;
        remaining = 30;
        score = 0;
        lastScore = null;
        updateDisplay();
        makeQuestion();
        answerInput.disabled = false;
        submitBtn.disabled = false;
        startBtn.disabled = true;
        msg.textContent = "é›†ä¸­ã—ã¦ã„ã“ã†ï¼";
        answerInput.value = "";
        answerInput.focus();

        if (timerId) clearInterval(timerId);
        timerId = setInterval(() => {
          remaining--;
          updateDisplay();
          if (remaining <= 0) {
            finishRun("time");
          }
        }, 1000);
      });

      submitBtn.addEventListener("click", handleAnswer);
      answerInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") handleAnswer();
      });

      endBtn.addEventListener("click", () => {
        if (playing) {
          finishRun("manual");
        }
        if (lastScore == null) {
          alert("ã¾ã ç™»éŒ²ã§ãã‚‹çµæœãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã¾ãšã¯ã‚²ãƒ¼ãƒ ã‚’ã‚¹ã‚¿ãƒ¼ãƒˆã—ã¦ã­ã€‚");
          resetAll();
          return;
        }
        askNameAndSave("calc", lastScore, true);
        resetAll();
      });

      resetBtn.addEventListener("click", () => {
        resetAll();
      });

      // ç”»é¢é·ç§»æ™‚ã«å¼·åˆ¶ãƒªã‚»ãƒƒãƒˆ
      window.calcForceStop = function () {
        if (timerId) clearInterval(timerId);
        timerId = null;
        playing = false;
        remaining = 30;
        score = 0;
        lastScore = null;
        updateDisplay();
        answerInput.disabled = true;
        submitBtn.disabled = true;
        startBtn.disabled = false;
        msg.textContent = "";
        questionEl.textContent = "ã€Œã‚¹ã‚¿ãƒ¼ãƒˆã€ã‚’æŠ¼ã—ã¦ã‚²ãƒ¼ãƒ é–‹å§‹ï¼";
      };
    })();

    // ===== è¨˜æ†¶åŠ›ã‚²ãƒ¼ãƒ ï¼ˆè‰²ãƒã‚¹ï¼‰ =====
    (function setupMemoryGame() {
      const tiles = Array.from(document.querySelectorAll(".memory-tile"));
      const levelEl = document.getElementById("memory-level");
      const startBtn = document.getElementById("memory-start-btn");
      const endBtn = document.getElementById("memory-end-btn");
      const resetBtn = document.getElementById("memory-reset-btn");
      const msg = document.getElementById("memory-message");

      let sequence = [];
      let userIndex = 0;
      let level = 0;
      let busyShowing = false;
      let playing = false;
      let showTimers = [];
      let lastScore = null;

      function clearTimers() {
        showTimers.forEach((id) => clearTimeout(id));
        showTimers = [];
      }

      function setLevelDisplay() {
        levelEl.textContent = level;
      }

      function flashTile(index, delay) {
        const tile = tiles[index];
        const t1 = setTimeout(() => {
          tile.classList.add("active");
        }, delay);
        const t2 = setTimeout(() => {
          tile.classList.remove("active");
        }, delay + 400);
        showTimers.push(t1, t2);
      }

      function showSequence() {
        busyShowing = true;
        msg.textContent = "ã‚ˆãè¦‹ã¦è¦šãˆã¦ã­â€¦";
        clearTimers();
        sequence.forEach((idx, i) => {
          flashTile(idx, i * 600);
        });
        const total = sequence.length * 600;
        const endTimer = setTimeout(() => {
          busyShowing = false;
          msg.textContent = "ä»Šåº¦ã¯åŒã˜é †ç•ªã§ã‚¿ãƒƒãƒ—ã—ã¦ã­ï¼";
        }, total + 500);
        showTimers.push(endTimer);
      }

      function nextRound() {
        level++;
        setLevelDisplay();
        userIndex = 0;
        sequence.push(Math.floor(Math.random() * 4));
        showSequence();
      }

      function gameOver() {
        playing = false;
        clearTimers();
        tiles.forEach((t) => t.classList.remove("active"));
        lastScore = level;
        msg.textContent = `ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼â€¦ åˆ°é”ãƒ¬ãƒ™ãƒ«ã¯ ${level} ã§ã—ãŸã€‚æº€è¶³ã—ãŸã‚‰ã€Œçµ‚äº†ãƒ»ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç™»éŒ²ã€ã§ç™»éŒ²ã§ãã¾ã™ã€‚`;
        startBtn.textContent = "ã‚‚ã†ä¸€å›ï¼";
      }

      function resetAll() {
        sequence = [];
        userIndex = 0;
        level = 0;
        setLevelDisplay();
        playing = false;
        busyShowing = false;
        clearTimers();
        tiles.forEach((t) => t.classList.remove("active"));
        msg.textContent = "ã¾ãšã¯ã€Œã‚¹ã‚¿ãƒ¼ãƒˆã€ã‚’æŠ¼ã—ã¦ã­ã€‚";
        startBtn.textContent = "ã‚¹ã‚¿ãƒ¼ãƒˆ";
        lastScore = null;
      }

      function startGame() {
        resetAll();
        playing = true;
        msg.textContent = "ã•ã‚ã€ã‚¹ã‚¿ãƒ¼ãƒˆï¼";
        startBtn.textContent = "ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ";
        nextRound();
      }

      startBtn.addEventListener("click", () => {
        if (busyShowing) return;
        startGame();
      });

      endBtn.addEventListener("click", () => {
        if (playing) {
          playing = false;
          clearTimers();
          tiles.forEach((t) => t.classList.remove("active"));
          msg.textContent = `æ‰‹å‹•ã§çµ‚äº†ã—ã¾ã—ãŸã€‚åˆ°é”ãƒ¬ãƒ™ãƒ«ã¯ ${level} ã§ã—ãŸã€‚`;
          lastScore = level;
        }
        if (!lastScore || lastScore <= 0) {
          alert("ã¾ã ç™»éŒ²ã§ãã‚‹çµæœãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã¾ãšã¯ãƒ—ãƒ¬ã‚¤ã—ã¦ã¿ã‚ˆã†ï¼");
          resetAll();
          return;
        }
        askNameAndSave("memory", lastScore, true);
        resetAll();
      });

      resetBtn.addEventListener("click", () => {
        resetAll();
      });

      tiles.forEach((tile) => {
        tile.addEventListener("click", () => {
          if (!playing || busyShowing) return;
          const idx = parseInt(tile.getAttribute("data-index"), 10);
          const expected = sequence[userIndex];
          if (idx === expected) {
            tile.classList.add("active");
            setTimeout(() => tile.classList.remove("active"), 200);
            userIndex++;
            if (userIndex >= sequence.length) {
              msg.textContent = "ã™ã”ã„ï¼æ¬¡ã®ãƒ¬ãƒ™ãƒ«ã¸ï¼";
              setTimeout(() => {
                nextRound();
              }, 700);
            }
          } else {
            gameOver();
          }
        });
      });
    })();

    // ===== ã‚¹ãƒˆãƒ«ãƒ¼ãƒ—è‰²ã“ã¨ã°ï¼ˆ30ç§’ã‚¿ã‚¤ãƒ ã‚¢ã‚¿ãƒƒã‚¯ï¼‰ =====
    (function setupStroop() {
      const colors = ["èµ¤", "é’", "ç·‘", "é»„"];
      const colorValues = {
        "èµ¤": "#ef4444",
        "é’": "#3b82f6",
        "ç·‘": "#22c55e",
        "é»„": "#eab308"
      };

      const wordEl = document.getElementById("stroop-word");
      const correctEl = document.getElementById("stroop-correct");
      const timeEl = document.getElementById("stroop-time");
      const msg = document.getElementById("stroop-message");
      const startBtn = document.getElementById("stroop-start-btn");
      const endBtn = document.getElementById("stroop-end-btn");
      const resetBtn = document.getElementById("stroop-reset-btn");
      const optionButtons = document.querySelectorAll("[data-stroop-answer]");

      let playing = false;
      let correct = 0;
      let remaining = 30;
      let timerId = null;
      let currentColor = null;
      let lastScore = null;

      function updateDisplay() {
        correctEl.textContent = correct;
        timeEl.textContent = remaining;
      }

      function newQuestion() {
        const textColor = colors[Math.floor(Math.random() * colors.length)];
        const inkColor = colors[Math.floor(Math.random() * colors.length)];
        currentColor = inkColor;
        wordEl.textContent = textColor;
        wordEl.style.color = colorValues[inkColor];
      }

      function resetAll() {
        playing = false;
        if (timerId) clearInterval(timerId);
        timerId = null;
        correct = 0;
        remaining = 30;
        lastScore = null;
        updateDisplay();
        wordEl.textContent = "ã‚¹ã‚¿ãƒ¼ãƒˆã‚’æŠ¼ã—ã¦ã­";
        wordEl.style.color = "#111827";
        msg.textContent = "";
      }

      function finishRun(reason) {
        playing = false;
        if (timerId) clearInterval(timerId);
        timerId = null;
        lastScore = correct;
        if (reason === "time") {
          msg.textContent = `æ™‚é–“åˆ‡ã‚Œï¼æ­£è§£æ•°ã¯ ${correct} å•ã§ã—ãŸã€‚`;
        } else if (reason === "manual") {
          msg.textContent = `æ‰‹å‹•ã§çµ‚äº†ã—ã¾ã—ãŸã€‚æ­£è§£æ•°ã¯ ${correct} å•ã§ã—ãŸã€‚`;
        }
      }

      startBtn.addEventListener("click", () => {
        playing = true;
        correct = 0;
        remaining = 30;
        lastScore = null;
        updateDisplay();
        msg.textContent = "ã‚¤ãƒ³ã‚¯ã®è‰²ã‚’ç­”ãˆã¦ã­ã€‚";
        newQuestion();

        if (timerId) clearInterval(timerId);
        timerId = setInterval(() => {
          remaining--;
          updateDisplay();
          if (remaining <= 0) {
            finishRun("time");
          }
        }, 1000);
      });

      optionButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          if (!playing) {
            msg.textContent = "ã¾ãšã¯ã€Œã‚¹ã‚¿ãƒ¼ãƒˆã€ã‚’æŠ¼ã—ã¦ã­ã€‚";
            return;
          }
          const ans = btn.getAttribute("data-stroop-answer");
          if (ans === currentColor) {
            correct++;
            msg.textContent = "æ­£è§£ï¼";
          } else {
            msg.textContent = "ãŠã—ã„â€¦ ã‚¤ãƒ³ã‚¯ã®è‰²ã‚’ã‚ˆãè¦‹ã¦ã¿ã‚ˆã†ã€‚";
          }
          lastScore = correct;
          newQuestion();
          updateDisplay();
        });
      });

      endBtn.addEventListener("click", () => {
        if (playing) {
          finishRun("manual");
        }
        if (lastScore == null) {
          alert("ã¾ã ç™»éŒ²ã§ãã‚‹çµæœãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã¾ãšã¯ãƒ—ãƒ¬ã‚¤ã—ã¦ã¿ã‚ˆã†ï¼");
          resetAll();
          return;
        }
        askNameAndSave("stroop", lastScore, true);
        resetAll();
      });

      resetBtn.addEventListener("click", () => {
        resetAll();
      });

      window.stroopForceStop = function () {
        if (timerId) clearInterval(timerId);
        timerId = null;
        playing = false;
        remaining = 30;
        correct = 0;
        lastScore = null;
        updateDisplay();
        wordEl.textContent = "ã‚¹ã‚¿ãƒ¼ãƒˆã‚’æŠ¼ã—ã¦ã­";
        wordEl.style.color = "#111827";
        msg.textContent = "";
      };

      updateDisplay();
    })();

    // ===== æ•°å­—ã‚¿ãƒƒãƒ— 1ã€œ25 =====
    (function setupTap25() {
      const board = document.getElementById("tap25-board");
      const nextEl = document.getElementById("tap25-next");
      const timeEl = document.getElementById("tap25-time");
      const startBtn = document.getElementById("tap25-start-btn");
      const endBtn = document.getElementById("tap25-end-btn");
      const resetBtn = document.getElementById("tap25-reset-btn");
      const msg = document.getElementById("tap25-message");

      let nextNumber = 1;
      let startTime = null;
      let timerId = null;
      let playing = false;
      let lastTimeSec = null;

      function updateDisplay() {
        nextEl.textContent = nextNumber;
      }

      function resetBoard() {
        board.innerHTML = "";
        const nums = Array.from({ length: 25 }, (_, i) => i + 1);
        for (let i = nums.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [nums[i], nums[j]] = [nums[j], nums[i]];
        }
        nums.forEach((n) => {
          const btn = document.createElement("button");
          btn.className = "tap25-cell";
          btn.textContent = n;
          btn.addEventListener("click", () => handleClick(btn, n));
          board.appendChild(btn);
        });
      }

      function handleClick(btn, num) {
        if (!playing) return;
        if (num === nextNumber) {
          btn.classList.add("done");
          if (nextNumber === 1) {
            startTime = performance.now();
            if (timerId) clearInterval(timerId);
            timerId = setInterval(() => {
              const t = (performance.now() - startTime) / 1000;
              timeEl.textContent = t.toFixed(1);
            }, 100);
          }
          nextNumber++;
          updateDisplay();
          if (nextNumber > 25) {
            playing = false;
            if (timerId) clearInterval(timerId);
            timerId = null;
            const t = (performance.now() - startTime) / 1000;
            lastTimeSec = Number(t.toFixed(1));
            msg.textContent = `ã‚¯ãƒªã‚¢ï¼ã‚¿ã‚¤ãƒ ã¯ ${lastTimeSec} ç§’ã§ã—ãŸã€‚æº€è¶³ã—ãŸã‚‰ã€Œçµ‚äº†ãƒ»ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç™»éŒ²ã€ã§ç™»éŒ²ã§ãã¾ã™ã€‚`;
          }
        } else {
          msg.textContent = "æ•°å­—ã¯é †ç•ªã«æŠ¼ã—ã¦ã­ã€‚";
        }
      }

      function resetAll() {
        playing = false;
        if (timerId) clearInterval(timerId);
        timerId = null;
        nextNumber = 1;
        startTime = null;
        lastTimeSec = null;
        timeEl.textContent = "0.0";
        updateDisplay();
        resetBoard();
        msg.textContent = "";
      }

      startBtn.addEventListener("click", () => {
        resetAll();
        playing = true;
        msg.textContent = "1ã‹ã‚‰é †ç•ªã«ã‚¿ãƒƒãƒ—ã—ã¦ã­ã€‚";
      });

      endBtn.addEventListener("click", () => {
        if (playing && nextNumber <= 25) {
          alert("ã¾ãšã¯ 25 ã¾ã§ã‚¿ãƒƒãƒ—ã—ã¦ã‚¯ãƒªã‚¢ã—ã¦ã‹ã‚‰ç™»éŒ²ã—ã¦ã­ã€‚");
          return;
        }
        if (lastTimeSec == null) {
          alert("ã¾ã ã‚¯ãƒªã‚¢ã—ãŸè¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã¾ãšã¯25ã¾ã§ã‚¿ãƒƒãƒ—ã—ã¦ã¿ã‚ˆã†ï¼");
          resetAll();
          return;
        }
        askNameAndSave("tap25", lastTimeSec, false);
        resetAll();
      });

      resetBtn.addEventListener("click", () => {
        resetAll();
      });

      window.tap25ForceStop = function () {
        if (timerId) clearInterval(timerId);
        timerId = null;
        playing = false;
        timeEl.textContent = "0.0";
        nextNumber = 1;
        updateDisplay();
        msg.textContent = "";
      };

      resetBoard();
      updateDisplay();
    })();

    // ===== ãƒ•ãƒ©ãƒƒã‚·ãƒ¥åˆè¨ˆï¼ˆé€£ç¶šæ­£è§£ï¼‰ =====
    (function setupFlash() {
      const numberEl = document.getElementById("flash-number");
      const streakEl = document.getElementById("flash-streak");
      const bestEl = document.getElementById("flash-best");
      const msg = document.getElementById("flash-message");
      const answerInput = document.getElementById("flash-answer");
      const nextBtn = document.getElementById("flash-next-btn");
      const submitBtn = document.getElementById("flash-submit-btn");
      const endBtn = document.getElementById("flash-end-btn");
      const resetBtn = document.getElementById("flash-reset-btn");

      let playing = false;
      let showing = false;
      let sum = 0;
      let count = 0;
      let timer = null;
      let streak = 0;
      let best = 0;
      let lastBestForRanking = null;
      let lastShown = null; // ç›´å‰ã®æ•°å­—

      function updateDisplay() {
        streakEl.textContent = streak;
        bestEl.textContent = best;
      }

      function showDigit(n) {
        numberEl.textContent = n;
        numberEl.classList.remove("flash-highlight");
        void numberEl.offsetWidth; // reflow
        numberEl.classList.add("flash-highlight");
      }

      function showSequence() {
        showing = true;
        sum = 0;
        count = 0;
        msg.textContent = "æ•°å­—ã‚’ã‚ˆãè¦‹ã¦ã€ã‚ã¨ã§åˆè¨ˆã‚’ç­”ãˆã¦ã­ã€‚";
        answerInput.value = "";
        answerInput.disabled = true;
        submitBtn.disabled = true;

        timer = setInterval(() => {
          if (count >= 7) {
            clearInterval(timer);
            timer = null;
            showing = false;
            numberEl.textContent = "?";
            answerInput.disabled = false;
            submitBtn.disabled = false;
            answerInput.focus();
            msg.textContent = "åˆè¨ˆã‚’å…¥åŠ›ã—ã¦ã€Œå›ç­”ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚";
            return;
          }
          let n;
          do {
            n = Math.floor(Math.random() * 9) + 1;
          } while (n === lastShown); // åŒã˜æ•°å­—ã‚’é€£ç¶šã•ã›ãªã„
          lastShown = n;
          sum += n;
          count++;
          showDigit(n);
        }, 700);
      }

      function resetAll() {
        if (timer) clearInterval(timer);
        timer = null;
        playing = false;
        showing = false;
        sum = 0;
        count = 0;
        streak = 0;
        best = 0;
        lastBestForRanking = null;
        lastShown = null;
        numberEl.textContent = "ã‚¹ã‚¿ãƒ¼ãƒˆã‚’æŠ¼ã—ã¦ã­";
        numberEl.classList.remove("flash-highlight");
        msg.textContent = "";
        answerInput.value = "";
        answerInput.disabled = true;
        submitBtn.disabled = true;
        updateDisplay();
      }

      function handleAnswer() {
        if (!playing || showing) return;
        const val = parseInt(answerInput.value, 10);
        if (Number.isNaN(val)) {
          msg.textContent = "æ•°å­—ã§å…¥åŠ›ã—ã¦ã­ã€‚";
          return;
        }
        if (val === sum) {
          streak++;
          if (streak > best) best = streak;
          lastBestForRanking = best;
          msg.textContent = `æ­£è§£ï¼ç¾åœ¨ã®é€£ç¶šæ­£è§£ã¯ ${streak} å›ã§ã™ã€‚ã€Œæ¬¡ã®å•é¡Œã€ã§ç¶šã‘ã‚ˆã†ã€‚`;
        } else {
          msg.textContent = `ä¸æ­£è§£â€¦ æ­£è§£ã¯ ${sum} ã§ã—ãŸã€‚é€£ç¶šæ­£è§£ã¯ 0 ã«ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚`;
          streak = 0;
          lastBestForRanking = best;
        }
        updateDisplay();
        answerInput.disabled = true;
        submitBtn.disabled = true;
      }

      nextBtn.addEventListener("click", () => {
        if (!playing) {
          playing = true;
          streak = 0;
          best = 0;
          lastBestForRanking = null;
          lastShown = null;
          updateDisplay();
        }
        if (showing) return;
        showSequence();
      });

      submitBtn.addEventListener("click", handleAnswer);
      answerInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") handleAnswer();
      });

      endBtn.addEventListener("click", () => {
        playing = false;
        if (timer) clearInterval(timer);
        timer = null;
        showing = false;
        if (!lastBestForRanking || lastBestForRanking <= 0) {
          alert("ã¾ã ç™»éŒ²ã§ãã‚‹çµæœãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã¾ãšã¯ä½•å•ã‹æ­£è§£ã—ã¦ã¿ã‚ˆã†ï¼");
          resetAll();
          return;
        }
        msg.textContent = `çµ‚äº†ã—ã¾ã—ãŸã€‚æœ€é«˜é€£ç¶šæ­£è§£ã¯ ${lastBestForRanking} å›ã§ã—ãŸã€‚`;
        askNameAndSave("flash", lastBestForRanking, true);
        resetAll();
      });

      resetBtn.addEventListener("click", () => {
        resetAll();
      });

      window.flashForceStop = function () {
        if (timer) clearInterval(timer);
        timer = null;
        playing = false;
        showing = false;
        numberEl.textContent = "ã‚¹ã‚¿ãƒ¼ãƒˆã‚’æŠ¼ã—ã¦ã­";
        numberEl.classList.remove("flash-highlight");
        msg.textContent = "";
        streak = 0;
        best = 0;
        lastBestForRanking = null;
        lastShown = null;
        updateDisplay();
      };

      updateDisplay();
    })();

    // åˆæœŸåŒ–ï¼šãƒ©ãƒ³ã‚­ãƒ³ã‚°èª­ã¿è¾¼ã¿ï¼†æç”»
    loadRankings();
    const allGames = [
      "reaction", "calc", "memory", "stroop",
      "tap25", "flash"
    ];
    allGames.forEach(renderRanking);
  </script>
</body>
</html>
